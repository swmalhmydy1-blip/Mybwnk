<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نظام القطيبي المتكامل للخدمات المصرفية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Cairo', sans-serif; } </style>
</head>
<body class="bg-gray-100">

    <div class="max-w-5xl mx-auto p-4">
        <header class="bg-[#004a99] text-white p-6 rounded-2xl mb-6 shadow-lg flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">بوابة القطيبي الإلكترونية</h1>
                <p id="acc-num" class="text-yellow-400 font-mono">حساب رقم: جاري التحميل...</p>
            </div>
            <div class="text-left">
                <p class="text-sm opacity-80">الرصيد الكلي</p>
                <h2 id="balance" class="text-3xl font-bold">0.00 YER</h2>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-green-500">
                <h3 class="font-bold text-lg mb-4 border-b pb-2"><i class="fas fa-cash-register ml-2"></i> إيداع / سحب نقدي</h3>
                <div class="space-y-4">
                    <input type="number" id="cash-amount" placeholder="أدخل المبلغ" class="w-full p-3 border rounded-lg outline-none focus:border-blue-500">
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="handleCash('deposit')" class="bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition">إيداع</button>
                        <button onclick="handleCash('withdraw')" class="bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 transition">سحب</button>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-800">
                <h3 class="font-bold text-lg mb-4 border-b pb-2"><i class="fas fa-paper-plane ml-2"></i> إرسال حوالة جديدة</h3>
                <div class="space-y-3">
                    <input type="text" id="remit-name" placeholder="اسم المستلم الكامل" class="w-full p-2 border rounded">
                    <input type="text" id="remit-phone" placeholder="رقم هاتف المستلم" class="w-full p-2 border rounded">
                    <input type="number" id="remit-amount" placeholder="المبلغ" class="w-full p-2 border rounded">
                    <button onclick="sendRemittance()" class="w-full bg-blue-800 text-white py-3 rounded-lg font-bold">تأكيد الإرسال</button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-yellow-500">
                <h3 class="font-bold text-lg mb-4 border-b pb-2"><i class="fas fa-key ml-2"></i> استلام حوالة واردة</h3>
                <p class="text-xs text-gray-500 mb-2">أدخل رقم الحوالة المكون من 8 أرقام</p>
                <div class="flex gap-2">
                    <input type="text" id="ref-number" placeholder="رقم الحوالة #REF" class="flex-1 p-3 border rounded-lg">
                    <button onclick="receiveRemittance()" class="bg-yellow-500 text-blue-900 px-6 py-2 rounded-lg font-bold hover:bg-yellow-600">صرف الحوالة</button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-gray-400">
                <h3 class="font-bold text-lg mb-4 border-b pb-2">آخر العمليات</h3>
                <div id="logs" class="text-sm space-y-2 max-h-48 overflow-y-auto font-mono">
                    </div>
            </div>

        </div>
    </div>

    <script>
        // إعدادات الاتصال (ضع مفاتيحك هنا)
        const supabaseUrl = 'https://YOUR_PROJECT.supabase.co'
        const supabaseKey = 'YOUR_ANON_KEY'
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey)

        // بيانات المستخدم الافتراضية (كمثال)
        let user = { id: 'USER_ID_HERE', balance: 500000, acc: '12209938' };

        // 1. وظيفة الإيداع والسحب
        async function handleCash(type) {
            const amount = parseFloat(document.getElementById('cash-amount').value);
            if(!amount || amount <= 0) return alert("أدخل مبلغاً صحيحاً");

            if(type === 'withdraw' && amount > user.balance) return alert("الرصيد غير كافٍ");

            const newBalance = type === 'deposit' ? user.balance + amount : user.balance - amount;
            
            // تحديث في Supabase (اختياري لو أردت الحفظ الفعلي)
            user.balance = newBalance;
            updateUI();
            addLog(`${type === 'deposit' ? 'إيداع' : 'سحب'}: ${amount} YER`);
        }

        // 2. وظيفة إرسال حوالة
        async function sendRemittance() {
            const name = document.getElementById('remit-name').value;
            const phone = document.getElementById('remit-phone').value;
            const amt = parseFloat(document.getElementById('remit-amount').value);
            const ref = "QT-" + Math.floor(10000000 + Math.random() * 90000000);

            if(amt > user.balance) return alert("الرصيد لا يسمح");

            user.balance -= amt;
            updateUI();
            addLog(`حوالة صادرة لـ ${name} برقم: ${ref}`);
            alert(`تم الإرسال! رقم الحوالة: ${ref}\nيرجى تزويد المستلم بالرقم.`);
        }

        // 3. وظيفة استلام حوالة
        function receiveRemittance() {
            const ref = document.getElementById('ref-number').value;
            if(!ref) return alert("يرجى إدخال رقم الحوالة");

            // محاكاة استلام مبلغ (مثلاً 15,000)
            const mockAmount = 15000;
            user.balance += mockAmount;
            updateUI();
            addLog(`استلام حوالة رقم ${ref} بمبلغ ${mockAmount}`);
            alert("تم صرف الحوالة بنجاح وإضافتها لرصيدك");
        }

        function updateUI() {
            document.getElementById('balance').innerText = user.balance.toLocaleString() + " YER";
            document.getElementById('acc-num').innerText = "حساب رقم: " + user.acc;
        }

        function addLog(msg) {
            const logBox = document.getElementById('logs');
            const now = new Date().toLocaleTimeString();
            logBox.innerHTML = `<div>[${now}] ${msg}</div>` + logBox.innerHTML;
        }

        // تشغيل البداية
        updateUI();
    </script>
</body>
    </html>
    
