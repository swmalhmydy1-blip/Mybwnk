<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø·ÙŠØ¨ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØµØ±ÙÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            transition: transform 0.3s ease;
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen">
    
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-screen" class="fixed inset-0 bg-gradient-to-br from-blue-900 to-blue-700 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <div class="bg-blue-600 inline-block p-4 rounded-2xl mb-4">
                    <i class="fas fa-university text-white text-4xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Ø§Ù„Ù‚Ø·ÙŠØ¨ÙŠ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h2>
                <p class="text-gray-600 mt-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                    <input type="text" id="login-account" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨" 
                           class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ</label>
                    <input type="password" id="login-pin" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ (6 Ø£Ø±Ù‚Ø§Ù…)" 
                           class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 outline-none" maxlength="6">
                </div>
                
                <button onclick="login()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-xl font-bold hover:from-blue-700 hover:to-blue-800 transition">
                    <i class="fas fa-sign-in-alt ml-2"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
                
                <div class="text-center mt-4">
                    <p class="text-sm text-gray-600">Ø­Ø³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ: 12209938 / 123456</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
    <div id="app" class="hidden">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
        <nav class="bg-gradient-to-l from-[#004a99] to-[#0066cc] text-white p-4 shadow-xl sticky top-0 z-40">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="bg-white p-2 rounded-lg">
                        <i class="fas fa-university text-blue-600 text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Ø§Ù„Ù‚Ø·ÙŠØ¨ÙŠ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h1>
                        <p class="text-sm opacity-80">Ø®Ø¯Ù…Ø§Øª Ù…ØµØ±ÙÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© ÙˆØ¢Ù…Ù†Ø©</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-6 space-x-reverse">
                    <div class="hidden md:block text-left">
                        <span id="user-name" class="font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <span class="text-sm opacity-80">Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„: </span>
                            <span id="last-login" class="text-sm">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                        </div>
                    </div>
                    <button onclick="toggleNotifications()" class="relative p-2">
                        <i class="fas fa-bell text-xl"></i>
                        <span id="notification-badge" class="absolute -top-1 -left-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg flex items-center space-x-2 space-x-reverse">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row mt-6 p-4 gap-6">
            <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
            <div class="md:w-1/4 space-y-4">
                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
                <div class="bg-gradient-to-br from-blue-900 to-blue-700 text-white p-6 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm opacity-80">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</p>
                            <h2 id="full-name" class="text-xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
                            <p id="user-acc" class="text-sm mt-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                        </div>
                        <i class="fas fa-user-circle text-4xl opacity-80"></i>
                    </div>
                    
                    <div class="mt-6">
                        <p class="text-sm">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</p>
                        <h3 id="balance" class="text-3xl font-bold mt-1">
                            <span class="animate-pulse">0.00</span> <span class="text-xl">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</span>
                        </h3>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mt-6">
                        <div class="text-center">
                            <p class="text-sm opacity-80">Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ</p>
                            <p id="monthly-income" class="font-bold">0 <span class="text-xs">Ø±ÙŠØ§Ù„</span></p>
                        </div>
                        <div class="text-center">
                            <p class="text-sm opacity-80">Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ</p>
                            <p id="monthly-expense" class="font-bold">0 <span class="text-xs">Ø±ÙŠØ§Ù„</span></p>
                        </div>
                    </div>
                </div>

                <!-- Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø¯Ø®Ø§Ø± -->
                <div class="bg-white rounded-2xl shadow-lg p-4">
                    <h3 class="font-bold text-lg mb-4 border-b pb-2"><i class="fas fa-bullseye ml-2"></i> Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø¯Ø®Ø§Ø±</h3>
                    <div id="savings-goals" class="space-y-3">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </div>
                    <button onclick="addSavingsGoal()" class="w-full mt-3 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm font-bold hover:bg-blue-100">
                        <i class="fas fa-plus ml-1"></i> Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <div class="md:w-3/4">
                <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
                <div id="notifications-panel" class="hidden mb-6 bg-white rounded-2xl shadow-lg p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg"><i class="fas fa-bell ml-2"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                        <button onclick="clearNotifications()" class="text-sm text-blue-600">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>
                    </div>
                    <div id="notifications-list" class="space-y-3">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </div>
                </div>

                <!-- Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø®Ø¯Ù…Ø§Øª -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ ÙˆØ§Ù„Ø³Ø­Ø¨ -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-green-500 card-hover">
                        <h3 class="font-bold text-lg mb-4 border-b pb-2"><i class="fas fa-cash-register ml-2"></i> Ø¥ÙŠØ¯Ø§Ø¹ / Ø³Ø­Ø¨ Ù†Ù‚Ø¯ÙŠ</h3>
                        <div class="space-y-4">
                            <div class="flex space-x-2 space-x-reverse">
                                <button onclick="quickAmount(50000)" class="flex-1 bg-blue-50 text-blue-700 py-2 rounded-lg hover:bg-blue-100">50,000</button>
                                <button onclick="quickAmount(100000)" class="flex-1 bg-blue-50 text-blue-700 py-2 rounded-lg hover:bg-blue-100">100,000</button>
                                <button onclick="quickAmount(200000)" class="flex-1 bg-blue-50 text-blue-700 py-2 rounded-lg hover:bg-blue-100">200,000</button>
                            </div>
                            <input type="number" id="cash-amount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" class="w-full p-3 border-2 border-gray-200 rounded-xl outline-none focus:border-blue-500 text-lg">
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="handleCash('deposit')" class="bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-bold hover:from-green-600 hover:to-green-700 transition flex items-center justify-center">
                                    <i class="fas fa-arrow-down ml-2"></i> Ø¥ÙŠØ¯Ø§Ø¹
                                </button>
                                <button onclick="handleCash('withdraw')" class="bg-gradient-to-r from-red-500 to-red-600 text-white py-3 rounded-xl font-bold hover:from-red-600 hover:to-red-700 transition flex items-center justify-center">
                                    <i class="fas fa-arrow-up ml-2"></i> Ø³Ø­Ø¨
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Ø­ÙˆØ§Ù„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-blue-800 card-hover">
                        <h3 class="font-bold text-lg mb-4 border-b pb-2"><i class="fas fa-paper-plane ml-2"></i> Ø¥Ø±Ø³Ø§Ù„ Ø­ÙˆØ§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                        <div class="space-y-3">
                            <select id="remit-type" class="w-full p-3 border rounded-lg">
                                <option value="internal">Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ù†Ùƒ</option>
                                <option value="external">Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¨Ù†Ùƒ</option>
                                <option value="international">Ø¯ÙˆÙ„ÙŠØ©</option>
                            </select>
                            <input type="text" id="remit-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full p-3 border rounded-lg">
                            <input type="text" id="remit-account" placeholder="Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="w-full p-3 border rounded-lg">
                            <input type="text" id="remit-phone" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªÙ„Ù…" class="w-full p-3 border rounded-lg">
                            <input type="number" id="remit-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" class="w-full p-3 border rounded-lg">
                            <button onclick="sendRemittance()" class="w-full bg-gradient-to-r from-blue-800 to-blue-900 text-white py-3 rounded-xl font-bold hover:from-blue-900 hover:to-blue-950 transition">
                                <i class="fas fa-paper-plane ml-2"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                            </button>
                        </div>
                    </div>

                    <!-- Ø§Ø³ØªÙ„Ø§Ù… Ø­ÙˆØ§Ù„Ø© -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-yellow-500 card-hover">
                        <h3 class="font-bold text-lg mb-4 border-b pb-2"><i class="fas fa-key ml-2"></i> Ø§Ø³ØªÙ„Ø§Ù… Ø­ÙˆØ§Ù„Ø© ÙˆØ§Ø±Ø¯Ø©</h3>
                        <p class="text-sm text-gray-500 mb-4">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø© Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 8 Ø£Ø±Ù‚Ø§Ù…</p>
                        <div class="space-y-3">
                            <input type="text" id="ref-number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø© #REF" class="w-full p-3 border-2 border-gray-200 rounded-lg">
                            <button onclick="receiveRemittance()" class="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 text-blue-900 py-3 rounded-xl font-bold hover:from-yellow-600 hover:to-yellow-700 transition">
                                <i class="fas fa-unlock ml-2"></i> ØµØ±Ù Ø§Ù„Ø­ÙˆØ§Ù„Ø©
                            </button>
                        </div>
                    </div>

                    <!-- Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-purple-500 card-hover">
                        <h3 class="font-bold text-lg mb-4 border-b pb-2"><i class="fas fa-calculator ml-2"></i> Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm mb-1">Ù…Ø¨Ù„Øº Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
                                <input type="range" id="loan-amount" min="100000" max="10000000" step="100000" value="5000000" class="w-full">
                                <div class="flex justify-between text-xs">
                                    <span>100,000</span>
                                    <span id="loan-amount-display" class="font-bold">5,000,000</span>
                                    <span>10,000,000</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm mb-1">Ø§Ù„Ù…Ø¯Ø© (Ø´Ù‡Ø±)</label>
                                <input type="range" id="loan-period" min="6" max="60" step="6" value="24" class="w-full">
                                <div class="flex justify-between text-xs">
                                    <span>6</span>
                                    <span id="loan-period-display" class="font-bold">24</span>
                                    <span>60</span>
                                </div>
                            </div>
                            <div class="p-3 bg-purple-50 rounded-lg">
                                <p class="text-sm font-bold text-purple-800">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</p>
                                <p id="monthly-payment" class="text-2xl font-bold text-purple-900">0 Ø±ÙŠØ§Ù„</p>
                            </div>
                            <button onclick="applyForLoan()" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-xl font-bold hover:from-purple-600 hover:to-purple-700 transition">
                                <i class="fas fa-file-signature ml-2"></i> ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ ØªÙ…ÙˆÙŠÙ„
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg"><i class="fas fa-history ml-2"></i> Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
                        <button onclick="loadTransactions()" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-sync-alt ml-2"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                    <div id="transactions-list" class="space-y-3 max-h-96 overflow-y-auto scrollbar-thin p-2">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ -->
        <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4">
                <h3 class="font-bold text-lg mb-4" id="confirm-title">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h3>
                <p id="confirm-message" class="mb-6"></p>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="confirmAction(true)" class="bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700">ØªØ£ÙƒÙŠØ¯</button>
                    <button onclick="confirmAction(false)" class="bg-red-600 text-white py-3 rounded-xl font-bold hover:bg-red-700">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>

        <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø§Ø¯Ø®Ø§Ø± -->
        <div id="savings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø§Ø¯Ø®Ø§Ø± Ø¬Ø¯ÙŠØ¯</h3>
                <div class="space-y-4">
                    <input type="text" id="goal-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‡Ø¯Ù (Ù…Ø«Ø§Ù„: Ø­Ø¬ Ø¨ÙŠØª Ø§Ù„Ù„Ù‡)" class="w-full p-3 border rounded-lg">
                    <input type="number" id="goal-target" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù" class="w-full p-3 border rounded-lg">
                    <input type="date" id="goal-date" class="w-full p-3 border rounded-lg">
                    <button onclick="saveSavingsGoal()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700">Ø­ÙØ¸ Ø§Ù„Ù‡Ø¯Ù</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Supabase
        const SUPABASE_URL = 'https://your-project.supabase.co'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù€ URL Ù…Ø´Ø±ÙˆØ¹Ùƒ
        const SUPABASE_ANON_KEY = 'your-anon-key'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù€ Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø¹Ø§Ù…
        
        // ØªÙ‡ÙŠØ¦Ø© Ø¹Ù…ÙŠÙ„ Supabase
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let currentUser = null;
        let pendingAction = null;
        let userBalance = 0;
        
        // Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function login() {
            const accountNumber = document.getElementById('login-account').value.trim();
            const pinCode = document.getElementById('login-pin').value.trim();
            
            if (!accountNumber || !pinCode) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ', 'error');
                return;
            }
            
            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const { data: user, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('account_number', accountNumber)
                    .eq('pin_code', pinCode)
                    .single();
                
                if (error) throw error;
                
                if (!user) {
                    showAlert('Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                    return;
                }
                
                if (!user.is_active) {
                    showAlert('Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙØ¹Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…', 'error');
                    return;
                }
                
                // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„
                await supabase
                    .from('users')
                    .update({ last_login: new Date().toISOString() })
                    .eq('id', user.id);
                
                // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                currentUser = user;
                userBalance = parseFloat(user.balance);
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                
                // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                loadUserData();
                loadNotifications();
                loadTransactions();
                loadSavingsGoals();
                
                // Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
                await addNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ', 'success');
                
                showAlert(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ${user.full_name}`, 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const { data: user, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                currentUser = user;
                userBalance = parseFloat(user.balance);
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('user-name').textContent = user.full_name;
                document.getElementById('full-name').textContent = user.full_name;
                document.getElementById('user-acc').textContent = `${user.account_type} â€¢ ${user.account_number}`;
                document.getElementById('balance').textContent = `${userBalance.toLocaleString()} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ`;
                document.getElementById('monthly-income').textContent = `${parseFloat(user.monthly_income).toLocaleString()} Ø±ÙŠØ§Ù„`;
                document.getElementById('monthly-expense').textContent = `${parseFloat(user.monthly_expense).toLocaleString()} Ø±ÙŠØ§Ù„`;
                
                if (user.last_login) {
                    const lastLogin = new Date(user.last_login);
                    document.getElementById('last-login').textContent = lastLogin.toLocaleString('ar-EG');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
            }
        }
        
        // Ø¥ÙŠØ¯Ø§Ø¹ Ø£Ùˆ Ø³Ø­Ø¨ Ù†Ù‚Ø¯ÙŠ
        async function handleCash(type) {
            if (!currentUser) return;
            
            const amountInput = document.getElementById('cash-amount');
            const amount = parseFloat(amountInput.value);
            
            if (!amount || amount <= 0) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            if (type === 'withdraw' && amount > userBalance) {
                showAlert('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ', 'error');
                return;
            }
            
            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            pendingAction = {
                type: 'cash',
                operation: type,
                amount: amount
            };
            
            showConfirmModal(
                type === 'deposit' ? 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹' : 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø³Ø­Ø¨',
                `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${type === 'deposit' ? 'Ø¥ÙŠØ¯Ø§Ø¹' : 'Ø³Ø­Ø¨'} Ù…Ø¨Ù„Øº ${amount.toLocaleString()} Ø±ÙŠØ§Ù„ØŸ`
            );
        }
        
        // ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹/Ø§Ù„Ø³Ø­Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯
        async function executeCashOperation() {
            if (!pendingAction || !currentUser) return;
            
            const { operation, amount } = pendingAction;
            const newBalance = operation === 'deposit' ? userBalance + amount : userBalance - amount;
            
            try {
                // ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const { error: updateError } = await supabase
                    .from('users')
                    .update({ balance: newBalance })
                    .eq('id', currentUser.id);
                
                if (updateError) throw updateError;
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                const { error: transactionError } = await supabase
                    .from('transactions')
                    .insert({
                        user_id: currentUser.id,
                        type: operation,
                        amount: amount,
                        description: operation === 'deposit' ? 'Ø¥ÙŠØ¯Ø§Ø¹ Ù†Ù‚Ø¯ÙŠ' : 'Ø³Ø­Ø¨ Ù†Ù‚Ø¯ÙŠ',
                        status: 'completed'
                    });
                
                if (transactionError) throw transactionError;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                userBalance = newBalance;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                await loadUserData();
                await loadTransactions();
                
                // Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±
                await addNotification(
                    `${operation === 'deposit' ? 'ØªÙ… Ø¥ÙŠØ¯Ø§Ø¹' : 'ØªÙ… Ø³Ø­Ø¨'} Ù…Ø¨Ù„Øº ${amount.toLocaleString()} Ø±ÙŠØ§Ù„`,
                    'success'
                );
                
                showAlert(
                    `${operation === 'deposit' ? 'ØªÙ… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹' : 'ØªÙ… Ø§Ù„Ø³Ø­Ø¨'} Ø¨Ù†Ø¬Ø§Ø­`,
                    'success'
                );
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø­ÙˆØ§Ù„Ø©
        async function sendRemittance() {
            if (!currentUser) return;
            
            const recipientName = document.getElementById('remit-name').value.trim();
            const recipientAccount = document.getElementById('remit-account').value.trim();
            const recipientPhone = document.getElementById('remit-phone').value.trim();
            const amount = parseFloat(document.getElementById('remit-amount').value);
            const transferType = document.getElementById('remit-type').value;
            
            if (!recipientName || !recipientPhone || !amount) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            if (amount > userBalance) {
                showAlert('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ', 'error');
                return;
            }
            
            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            pendingAction = {
                type: 'remittance',
                recipientName: recipientName,
                recipientAccount: recipientAccount,
                recipientPhone: recipientPhone,
                amount: amount,
                transferType: transferType
            };
            
            showConfirmModal(
                'ØªØ£ÙƒÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­ÙˆØ§Ù„Ø©',
                `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ø­ÙˆØ§Ù„Ø© Ø¨Ù…Ø¨Ù„Øº ${amount.toLocaleString()} Ø±ÙŠØ§Ù„ Ø¥Ù„Ù‰ ${recipientName}ØŸ`
            );
        }
        
        // ØªÙ†ÙÙŠØ° Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­ÙˆØ§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯
        async function executeRemittance() {
            if (!pendingAction || !currentUser) return;
            
            const { recipientName, recipientAccount, recipientPhone, amount, transferType } = pendingAction;
            
            try {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©
                const fee = transferType === 'international' ? amount * 0.03 : amount * 0.01;
                const totalAmount = amount + fee;
                
                if (totalAmount > userBalance) {
                    showAlert(`Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ø§ ÙŠÙƒÙÙŠ (Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¹Ù…ÙˆÙ„Ø© ${fee.toLocaleString()} Ø±ÙŠØ§Ù„)`, 'error');
                    return;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ù…Ø±Ø¬Ø¹ÙŠ Ù„Ù„Ø­ÙˆØ§Ù„Ø©
                const referenceNumber = 'QT' + Date.now().toString().slice(-8);
                
                // ØªØ®ÙÙŠØ¶ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const newBalance = userBalance - totalAmount;
                
                const { error: updateError } = await supabase
                    .from('users')
                    .update({ balance: newBalance })
                    .eq('id', currentUser.id);
                
                if (updateError) throw updateError;
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ù„Ø©
                const { error: remittanceError } = await supabase
                    .from('remittances')
                    .insert({
                        sender_id: currentUser.id,
                        sender_name: currentUser.full_name,
                        sender_account: currentUser.account_number,
                        recipient_name: recipientName,
                        recipient_phone: recipientPhone,
                        recipient_account: recipientAccount,
                        amount: amount,
                        reference_number: referenceNumber,
                        transfer_type: transferType,
                        fee: fee,
                        status: 'pending',
                        pin_code: Math.floor(1000 + Math.random() * 9000).toString()
                    });
                
                if (remittanceError) throw remittanceError;
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                const { error: transactionError } = await supabase
                    .from('transactions')
                    .insert({
                        user_id: currentUser.id,
                        type: 'transfer',
                        amount: amount,
                        description: `Ø­ÙˆØ§Ù„Ø© Ø¥Ù„Ù‰ ${recipientName}`,
                        reference_number: referenceNumber,
                        recipient_name: recipientName,
                        fee: fee,
                        status: 'completed'
                    });
                
                if (transactionError) throw transactionError;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                userBalance = newBalance;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                await loadUserData();
                await loadTransactions();
                
                // Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±
                await addNotification(
                    `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø­ÙˆØ§Ù„Ø© Ø¨Ù…Ø¨Ù„Øº ${amount.toLocaleString()} Ø±ÙŠØ§Ù„ Ø¥Ù„Ù‰ ${recipientName}`,
                    'success'
                );
                
                showAlert(
                    `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­ÙˆØ§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø©: ${referenceNumber}`,
                    'success'
                );
                
                // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('remit-name').value = '';
                document.getElementById('remit-account').value = '';
                document.getElementById('remit-phone').value = '';
                document.getElementById('remit-amount').value = '';
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­ÙˆØ§Ù„Ø©:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­ÙˆØ§Ù„Ø©', 'error');
            }
        }
        
        // Ø§Ø³ØªÙ„Ø§Ù… Ø­ÙˆØ§Ù„Ø©
        async function receiveRemittance() {
            const referenceNumber = document.getElementById('ref-number').value.trim();
            
            if (!referenceNumber) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø©', 'error');
                return;
            }
            
            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ù„Ø©
                const { data: remittance, error } = await supabase
                    .from('remittances')
                    .select('*')
                    .eq('reference_number', referenceNumber)
                    .eq('status', 'pending')
                    .single();
                
                if (error) {
                    if (error.code === 'PGRST116') {
                        showAlert('Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø© ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØªÙ… ØµØ±ÙÙ‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error');
                    } else {
                        throw error;
                    }
                    return;
                }
                
                // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­ÙˆØ§Ù„Ø© Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ…)
                const createdDate = new Date(remittance.created_at);
                const now = new Date();
                const daysDiff = (now - createdDate) / (1000 * 60 * 60 * 24);
                
                if (daysDiff > 30) {
                    showAlert('Ø§Ù„Ø­ÙˆØ§Ù„Ø© Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ…)', 'error');
                    return;
                }
                
                // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                pendingAction = {
                    type: 'receive_remittance',
                    remittance: remittance
                };
                
                showConfirmModal(
                    'ØªØ£ÙƒÙŠØ¯ ØµØ±Ù Ø§Ù„Ø­ÙˆØ§Ù„Ø©',
                    `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØµØ±Ù Ø­ÙˆØ§Ù„Ø© Ø¨Ù…Ø¨Ù„Øº ${parseFloat(remittance.amount).toLocaleString()} Ø±ÙŠØ§Ù„ Ù…Ù† ${remittance.sender_name}ØŸ`
                );
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ù„Ø©:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ù„Ø©', 'error');
            }
        }
        
        // ØªÙ†ÙÙŠØ° Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯
        async function executeReceiveRemittance() {
            if (!pendingAction || !currentUser) return;
            
            const { remittance } = pendingAction;
            
            try {
                // Ø²ÙŠØ§Ø¯Ø© Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const newBalance = userBalance + parseFloat(remittance.amount);
                
                const { error: updateError } = await supabase
                    .from('users')
                    .update({ balance: newBalance })
                    .eq('id', currentUser.id);
                
                if (updateError) throw updateError;
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­ÙˆØ§Ù„Ø©
                const { error: remittanceError } = await supabase
                    .from('remittances')
                    .update({
                        status: 'collected',
                        collected_at: new Date().toISOString()
                    })
                    .eq('id', remittance.id);
                
                if (remittanceError) throw remittanceError;
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                const { error: transactionError } = await supabase
                    .from('transactions')
                    .insert({
                        user_id: currentUser.id,
                        type: 'deposit',
                        amount: remittance.amount,
                        description: `Ø§Ø³ØªÙ„Ø§Ù… Ø­ÙˆØ§Ù„Ø© Ù…Ù† ${remittance.sender_name}`,
                        reference_number: remittance.reference_number,
                        status: 'completed'
                    });
                
                if (transactionError) throw transactionError;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                userBalance = newBalance;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                await loadUserData();
                await loadTransactions();
                
                // Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±
                await addNotification(
                    `ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø­ÙˆØ§Ù„Ø© Ø¨Ù…Ø¨Ù„Øº ${parseFloat(remittance.amount).toLocaleString()} Ø±ÙŠØ§Ù„`,
                    'success'
                );
                
                showAlert(
                    `ØªÙ… ØµØ±Ù Ø§Ù„Ø­ÙˆØ§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…Ø¨Ù„Øº: ${parseFloat(remittance.amount).toLocaleString()} Ø±ÙŠØ§Ù„`,
                    'success'
                );
                
                // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚Ù„
                document.getElementById('ref-number').value = '';
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØµØ±Ù Ø§Ù„Ø­ÙˆØ§Ù„Ø©:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØµØ±Ù Ø§Ù„Ø­ÙˆØ§Ù„Ø©', 'error');
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
        async function loadTransactions() {
            if (!currentUser) return;
            
            try {
                const { data: transactions, error } = await supabase
                    .from('transactions')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                const container = document.getElementById('transactions-list');
                container.innerHTML = '';
                
                if (!transactions || transactions.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</p>';
                    return;
                }
                
                transactions.forEach(transaction => {
                    const transactionElement = document.createElement('div');
                    transactionElement.className = 'p-4 border rounded-lg hover:bg-gray-50';
                    
                    const typeIcons = {
                        'deposit': { icon: 'â¬‡ï¸', color: 'text-green-600', bg: 'bg-green-50' },
                        'withdraw': { icon: 'â¬†ï¸', color: 'text-red-600', bg: 'bg-red-50' },
                        'transfer': { icon: 'â†ªï¸', color: 'text-blue-600', bg: 'bg-blue-50' },
                        'bill': { icon: 'ğŸ§¾', color: 'text-purple-600', bg: 'bg-purple-50' },
                        'loan': { icon: 'ğŸ’°', color: 'text-yellow-600', bg: 'bg-yellow-50' }
                    };
                    
                    const typeInfo = typeIcons[transaction.type] || { icon: 'â„¹ï¸', color: 'text-gray-600', bg: 'bg-gray-50' };
                    const amount = parseFloat(transaction.amount).toLocaleString();
                    const date = new Date(transaction.created_at).toLocaleString('ar-EG');
                    
                    transactionElement.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="text-xl ml-2">${typeInfo.icon}</span>
                                <div>
                                    <p class="font-bold ${typeInfo.color}">${transaction.description || transaction.type}</p>
                                    ${transaction.reference_number ? 
                                        `<p class="text-xs text-gray-500">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹: ${transaction.reference_number}</p>` : ''}
                                    ${transaction.recipient_name ? 
                                        `<p class="text-xs text-gray-500">Ø§Ù„Ù…Ø³ØªÙ„Ù…: ${transaction.recipient_name}</p>` : ''}
                                </div>
                            </div>
                            <div class="text-left">
                                <p class="font-bold ${transaction.type === 'deposit' ? 'text-green-600' : 'text-red-600'}">
                                    ${transaction.type === 'deposit' ? '+' : '-'} ${amount} Ø±ÙŠØ§Ù„
                                </p>
                                <p class="text-xs text-gray-500">${date}</p>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(transactionElement);
                });
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', 'error');
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        async function loadNotifications() {
            if (!currentUser) return;
            
            try {
                const { data: notifications, error } = await supabase
                    .from('notifications')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                
                const container = document.getElementById('notifications-list');
                const badge = document.getElementById('notification-badge');
                
                if (notifications && notifications.length > 0) {
                    const unreadCount = notifications.filter(n => !n.is_read).length;
                    
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                    
                    container.innerHTML = '';
                    notifications.forEach(notification => {
                        const notificationElement = document.createElement('div');
                        notificationElement.className = `p-3 rounded-lg ${notification.is_read ? 'bg-gray-50' : 'bg-blue-50 border-r-4 border-blue-500'}`;
                        
                        notificationElement.innerHTML = `
                            <p class="text-sm ${notification.is_read ? '' : 'font-bold'}">${notification.message}</p>
                            <p class="text-xs text-gray-500 mt-1">
                                ${new Date(notification.created_at).toLocaleString('ar-EG')}
                            </p>
                        `;
                        
                        container.appendChild(notificationElement);
                    });
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', error);
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø¯Ø®Ø§Ø±
        async function loadSavingsGoals() {
            if (!currentUser) return;
            
            try {
                const { data: goals, error } = await supabase
                    .from('savings_goals')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const container = document.getElementById('savings-goals');
                container.innerHTML = '';
                
                if (!goals || goals.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‡Ø¯Ø§Ù Ø§Ø¯Ø®Ø§Ø±</p>';
                    return;
                }
                
                goals.forEach(goal => {
                    const goalElement = document.createElement('div');
                    const percentage = (parseFloat(goal.current_amount) / parseFloat(goal.target_amount)) * 100;
                    
                    goalElement.innerHTML = `
                        <div class="mb-2">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-bold">${goal.name}</span>
                                <span>${Math.round(percentage)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="h-2 rounded-full" style="width: ${percentage}%; background-color: ${goal.color || '#10B981'}"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">
                                ${parseFloat(goal.current_amount).toLocaleString()} / ${parseFloat(goal.target_amount).toLocaleString()} Ø±ÙŠØ§Ù„
                            </p>
                        </div>
                    `;
                    
                    container.appendChild(goalElement);
                });
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø¯Ø®Ø§Ø±:', error);
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø§Ø¯Ø®Ø§Ø± Ø¬Ø¯ÙŠØ¯
        function addSavingsGoal() {
            document.getElementById('savings-modal').classList.remove('hidden');
        }
        
        async function saveSavingsGoal() {
            const name = document.getElementById('goal-name').value.trim();
            const target = parseFloat(document.getElementById('goal-target').value);
            const date = document.getElementById('goal-date').value;
            
            if (!name || !target || target <= 0) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('savings_goals')
                    .insert({
                        user_id: currentUser.id,
                        name: name,
                        target_amount: target,
                        target_date: date || null,
                        current_amount: 0
                    });
                
                if (error) throw error;
                
                document.getElementById('savings-modal').classList.add('hidden');
                document.getElementById('goal-name').value = '';
                document.getElementById('goal-target').value = '';
                document.getElementById('goal-date').value = '';
                
                await loadSavingsGoals();
                await addNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø§Ø¯Ø®Ø§Ø± Ø¬Ø¯ÙŠØ¯: ${name}`, 'success');
                showAlert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø§Ù„Ø§Ø¯Ø®Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø§Ù„Ø§Ø¯Ø®Ø§Ø±:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø§Ù„Ø§Ø¯Ø®Ø§Ø±', 'error');
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±
        async function addNotification(message, type = 'info') {
            if (!currentUser) return;
            
            try {
                const title = type === 'success' ? 'Ø¹Ù…Ù„ÙŠØ© Ù†Ø§Ø¬Ø­Ø©' : 
                             type === 'error' ? 'Ø®Ø·Ø£' : 
                             type === 'warning' ? 'ØªØ­Ø°ÙŠØ±' : 'Ù…Ø¹Ù„ÙˆÙ…Ø©';
                
                const { error } = await supabase
                    .from('notifications')
                    .insert({
                        user_id: currentUser.id,
                        title: title,
                        message: message,
                        type: type
                    });
                
                if (error) throw error;
                
                await loadNotifications();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:', error);
            }
        }
        
        // ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©
        async function clearNotifications() {
            if (!currentUser) return;
            
            try {
                const { error } = await supabase
                    .from('notifications')
                    .update({ is_read: true })
                    .eq('user_id', currentUser.id)
                    .eq('is_read', false);
                
                if (error) throw error;
                
                await loadNotifications();
                showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©', 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'error');
            }
        }
        
        // ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„ØªÙ…ÙˆÙŠÙ„
        async function applyForLoan() {
            const amount = parseInt(document.getElementById('loan-amount').value);
            const period = parseInt(document.getElementById('loan-period').value);
            
            pendingAction = {
                type: 'loan_application',
                amount: amount,
                period: period
            };
            
            showConfirmModal(
                'ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ ØªÙ…ÙˆÙŠÙ„',
                `Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ ØªÙ…ÙˆÙŠÙ„ Ø¨Ù…Ø¨Ù„Øº ${amount.toLocaleString()} Ø±ÙŠØ§Ù„ Ù„Ù…Ø¯Ø© ${period} Ø´Ù‡Ø±Ø§Ù‹ØŸ`
            );
        }
        
        async function executeLoanApplication() {
            if (!pendingAction || !currentUser) return;
            
            const { amount, period } = pendingAction;
            const interestRate = 0.05; // 5%
            const monthlyRate = interestRate / 12;
            const monthlyPayment = (amount * monthlyRate * Math.pow(1 + monthlyRate, period)) / 
                                  (Math.pow(1 + monthlyRate, period) - 1);
            const totalAmount = monthlyPayment * period;
            
            try {
                const { error } = await supabase
                    .from('loans')
                    .insert({
                        user_id: currentUser.id,
                        amount: amount,
                        period_months: period,
                        monthly_payment: monthlyPayment,
                        total_amount: totalAmount,
                        interest_rate: interestRate,
                        status: 'pending',
                        purpose: 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'
                    });
                
                if (error) throw error;
                
                await addNotification(
                    `ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ ØªÙ…ÙˆÙŠÙ„ Ø¨Ù…Ø¨Ù„Øº ${amount.toLocaleString()} Ø±ÙŠØ§Ù„ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø©`,
                    'success'
                );
                
                showAlert(
                    'ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹',
                    'success'
                );
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„ØªÙ…ÙˆÙŠÙ„:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„ØªÙ…ÙˆÙŠÙ„', 'error');
            }
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        function quickAmount(amount) {
            document.getElementById('cash-amount').value = amount;
        }
        
        function showConfirmModal(title, message) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            document.getElementById('confirm-modal').classList.remove('hidden');
        }
        
        function confirmAction(confirmed) {
            document.getElementById('confirm-modal').classList.add('hidden');
            
            if (!confirmed || !pendingAction) {
                pendingAction = null;
                return;
            }
            
            switch (pendingAction.type) {
                case 'cash':
                    executeCashOperation();
                    break;
                case 'remittance':
                    executeRemittance();
                    break;
                case 'receive_remittance':
                    executeReceiveRemittance();
                    break;
                case 'loan_application':
                    executeLoanApplication();
                    break;
            }
            
            pendingAction = null;
        }
        
        function showAlert(message, type = 'info') {
            // ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ SweetAlert2
            alert(`${type === 'error' ? 'âš ï¸ Ø®Ø·Ø£: ' : type === 'success' ? 'âœ… Ù†Ø¬Ø§Ø­: ' : 'â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø©: '}${message}`);
        }
        
        function toggleNotifications() {
            const panel = document.getElementById('notifications-panel');
            panel.classList.toggle('hidden');
        }
        
        function logout() {
            currentUser = null;
            userBalance = 0;
            pendingAction = null;
            
            document.getElementById('app').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            
            // ØªÙØ±ÙŠØº Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('login-pin').value = '';
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„
        function updateLoanCalculator() {
            const amount = parseInt(document.getElementById('loan-amount').value);
            const period = parseInt(document.getElementById('loan-period').value);
            
            document.getElementById('loan-amount-display').textContent = amount.toLocaleString();
            document.getElementById('loan-period-display').textContent = period;
            
            const interestRate = 0.05;
            const monthlyRate = interestRate / 12;
            const monthlyPayment = (amount * monthlyRate * Math.pow(1 + monthlyRate, period)) / 
                                  (Math.pow(1 + monthlyRate, period) - 1);
            
            document.getElementById('monthly-payment').textContent = Math.round(monthlyPayment).toLocaleString() + ' Ø±ÙŠØ§Ù„';
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ù…Ù†Ø²Ù„Ù‚Ø§Øª
            document.getElementById('loan-amount').addEventListener('input', updateLoanCalculator);
            document.getElementById('loan-period').addEventListener('input', updateLoanCalculator);
            
            // ØªÙ‡ÙŠØ¦Ø© Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„
            updateLoanCalculator();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø¯Ø®Ø§Ø±
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('goal-date').min = today;
        });
    </script>
</body>
                        </html>
